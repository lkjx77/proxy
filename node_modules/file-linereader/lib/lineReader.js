/**
 * Read File Content By Line
 */

var fs = require('fs'),
    util = require('util'),
    ReadStream = fs.ReadStream;

function LineReadStream(path, options) {
  if (!(this instanceof LineReadStream)) {
      return new LineReadStream(path, options);
  }

  ReadStream.apply(this, arguments);

  this._init();
}
util.inherits(LineReadStream, ReadStream);

LineReadStream.prototype._init = function() {
    var self = this,
        remainder = '';
    this.on('data', function(buffer) {
        var data = remainder + buffer.toString(),
            pos, line;
        while((pos = data.indexOf('\n')) !== -1) {
            line = data.substr(0, pos);
            self.emit('line', line);
            data = data.substr(pos + 1);
        }
        remainder = data;
    });
    return this;
};

exports.LineReadStream = LineReadStream;

exports.eachLine = function(path, options, callback) {
    if(typeof options == 'function') {
        callback = options;
        options = {};
    }
    var stream = new LineReadStream(path, options);
    stream.on('line', callback);
    return stream;
};


